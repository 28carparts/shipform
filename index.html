<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>28CarParts Email Ship Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            box-sizing: border-box;
        }
        h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.2em;
            font-weight: 700;
            width: 100%;
        }
        .main-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            max-width: 1200px;
            width: 100%;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            box-sizing: border-box;
        }
        form {
            flex: 1;
            min-width: 450px;
            padding: 0;
            box-shadow: none;
            background-color: transparent;
            border-radius: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 1.05em;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            background-color: #f7fafc;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-sizing: border-box;
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 45px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
            line-height: 1;
        }
        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        .var2, .var3, .var4 {
            background-color: #edf2f7;
            color: #4a5568;
        }
        .var2.selected, .var3.selected, .var4.selected {
            background-color: #4299e1;
            color: white;
            box-shadow: 0 4px 10px rgba(66, 153, 225, 0.3);
        }
        #generateButton {
            background-color: #48bb78;
            color: white;
            width: calc(50% - 10px);
            margin: 0 5px;
            font-weight: 600;
        }
        #generateButton:hover {
            background-color: #38a169;
        }
        #clearButton {
            background-color: #ef4444;
            color: white;
            width: calc(50% - 10px);
            margin: 0 5px;
            font-weight: 600;
        }
        #clearButton:hover {
            background-color: #dc2626;
        }
        .output-section {
            flex: 1;
            min-width: 450px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        #output {
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #f7fafc;
            white-space: pre-wrap;
            font-size: 0.95em;
            line-height: 1.7;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.03);
            min-height: 120px;
            color: #2d3748;
            flex-grow: 1;
            margin-bottom: 20px;
        }
        #copyButton {
            background-color: #ed8936;
            color: white;
            padding: 12px 20px;
            width: 100%;
            margin-top: 0;
            font-weight: 600;
        }
        #copyButton:disabled {
            background-color: #cbd5e0;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        #copyButton:hover:not(:disabled) {
            background-color: #dd6b20;
        }
        .checkbox-label-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .checkbox-label-group label {
            margin-bottom: 0;
            margin-left: 8px;
            font-weight: 500;
            color: #4a5568;
        }
        .checkbox-label-group input[type="checkbox"] {
            width: auto;
            margin-right: 0;
            transform: scale(1.2);
            accent-color: #4299e1;
        }
        .flex-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .flex-container .form-group {
            flex: 1;
            min-width: 250px;
            margin-bottom: 0;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .button-group button {
            flex: 1;
            min-width: 120px;
            margin: 0;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                gap: 20px;
                padding: 25px;
            }
            form, .output-section {
                min-width: unset;
                width: 100%;
            }
            #generateButton, #clearButton {
                width: calc(50% - 10px);
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            h2 {
                font-size: 2em;
                margin-bottom: 25px;
            }
            .main-container {
                padding: 20px;
            }
            #generateButton, #clearButton {
                width: 100%;
                margin: 5px 0;
            }
            .flex-container .form-group {
                min-width: 100%;
            }
            .button-group button {
                min-width: 100px;
            }
        }
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            h2 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }
            .main-container {
                padding: 15px;
            }
            button {
                padding: 10px 15px;
                min-height: 40px;
                font-size: 0.95em;
            }
            #output {
                padding: 15px;
                font-size: 0.9em;
            }
        }

        /* Custom message box styling (improved) */
        #customMessageBox {
            position: fixed;
            top: 50%;
            left: 50%;
            /* transform: translate(-50%, -50%); Is set by show/hide states */
            background-color: #2d3748;
            color: white;
            padding: 18px 30px;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            z-index: 10000; /* Ensure it's above other elements */
            font-size: 1.1em;
            font-weight: 500;
            text-align: center;
            min-width: 250px;
            
            /* Initial state for transition: hidden and out of layout */
            display: none;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.9); 
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #customMessageBox.show {
            /* display: block; will be set by JS */
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <h2>28CarParts Email Ship Form</h2>
        <form id="orderForm">
            <div class="form-group">
                <div class="checkbox-label-group">
                    <input type="checkbox" id="enableDateField" checked>
                    <label for="enableDateField">Date (DD MM YYYY):</label>
                </div>
                <input type="text" id="dateField">
            </div>
            <div class="form-group">
                <label for="formNumber">SF Form Number:</label>
                <input type="text" id="formNumber" placeholder="Enter SF form number">
            </div>

            <div class="flex-container">
                <div class="form-group">
                    <label>Ship Payment:</label>
                    <div class="button-group">
                        <button type="button" class="var2" data-value="寄付">寄付</button>
                        <button type="button" class="var2" data-value="到付">到付</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Sender:</label>
                    <div class="button-group">
                        <button type="button" class="var3" data-value="我交下來">我交下來</button>
                        <button type="button" class="var3" data-value="TSC交下來">TSC交下來</button>
                        <button type="button" class="var3" data-value="用我貨">用我貨</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Shipping Option:</label>
                <div class="button-group">
                    <button type="button" class="var4" data-value="店到店優惠">店到店優惠</button>
                    <button type="button" class="var4" data-value="店到門優惠">店到門優惠</button>
                    <button type="button" class="var4" data-value="E-Comm Box">E-Comm Box</button>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox-label-group">
                    <input type="checkbox" id="enableNotesField" checked>
                    <label for="enableNotesField">Order Items:</label>
                </div>
                <textarea id="notes" rows="4" placeholder="Enter order items"></textarea>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                <button type="button" id="generateButton" onclick="generateMessage()">Generate Message</button>
                <button type="button" id="clearButton" onclick="clearForm()">Clear</button>
            </div>
        </form>

        <div class="output-section">
            <div id="output"></div>
            <button id="copyButton" onclick="copyToClipboard()" disabled>Copy to Clipboard</button>
        </div>
    </div>

    <!-- Message box element will be created here by JS if it doesn't exist,
         or you can pre-define it here and ensure it has the #customMessageBox id -->
    <script>
        // DOM Elements
        const dateField = document.getElementById('dateField');
        const formNumberField = document.getElementById('formNumber');
        const notesField = document.getElementById('notes');
        const outputArea = document.getElementById('output');
        const copyButton = document.getElementById('copyButton');
        const enableDateFieldCheckbox = document.getElementById('enableDateField');
        const enableNotesFieldCheckbox = document.getElementById('enableNotesField');

        // Function to set current date in DD MMM YYYY format
        function setCurrentDate() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = months[today.getMonth()];
            const year = today.getFullYear();
            dateField.value = `${day} ${month} ${year}`;
        }

        // Set current date on initial page load
        setCurrentDate();

        // Auto-save and load Form Number from localStorage
        const savedFormNumber = localStorage.getItem('formNumber');
        if (savedFormNumber) {
            formNumberField.value = savedFormNumber;
        }
        formNumberField.addEventListener('input', function() {
            localStorage.setItem('formNumber', this.value);
        });

        // Button selection logic (Improved)
        document.querySelectorAll('.button-group button.var2, .button-group button.var3, .button-group button.var4').forEach(button => {
            button.addEventListener('click', function() {
                let groupClass = '';
                if (this.classList.contains('var2')) groupClass = 'var2';
                else if (this.classList.contains('var3')) groupClass = 'var3';
                else if (this.classList.contains('var4')) groupClass = 'var4';

                if (groupClass) {
                    const parentButtonGroup = this.closest('.button-group');
                    if (parentButtonGroup) {
                        parentButtonGroup.querySelectorAll(`button.${groupClass}`).forEach(btn => {
                            btn.classList.remove('selected');
                        });
                    }
                }
                this.classList.add('selected');
            });
        });

        // Function to set initial default selections for the button groups
        function setDefaultSelections() {
            const defaultVar2Button = document.querySelector('.var2[data-value="寄付"]');
            if (defaultVar2Button) defaultVar2Button.classList.add('selected');

            const defaultVar3Button = document.querySelector('.var3[data-value="我"]');
            if (defaultVar3Button) defaultVar3Button.classList.add('selected');

            const defaultVar4Button = document.querySelector('.var4[data-value="店到店優惠"]');
            if (defaultVar4Button) defaultVar4Button.classList.add('selected');
        }

        // Call setDefaultSelections on page load
        document.addEventListener('DOMContentLoaded', setDefaultSelections);


        function generateMessage() {
            const useDate = enableDateFieldCheckbox.checked;
            const useNotes = enableNotesFieldCheckbox.checked;

            const dateValue = useDate ? dateField.value : '';
            const formNumberValue = formNumberField.value || '[Form Number]';
            const var2Value = document.querySelector('.var2.selected')?.dataset.value || '[寄付/到付]';
            const var3Value = document.querySelector('.var3.selected')?.dataset.value || '[我/TSC]';
            const var4Value = document.querySelector('.var4.selected')?.dataset.value || '[店到店優惠/店到門優惠/E-Comm Box]';
            const notesValueText = notesField.value;
            const notesContent = useNotes && notesValueText ? notesValueText : '';

            const dateLine = useDate ? `Your 28CarParts Store order confirmation - 入數交易 ${dateValue} (x)` : '';
            
            let message = `${dateLine}${dateLine ? '\n\n' : ''}Hi Angle,

Please help to ship, thanks!
- Form #${formNumberValue} (${var2Value})
- ${var3Value} (${var4Value})`;

            if (notesContent) {
                message += `\n\n${notesContent}`;
            }

            outputArea.textContent = message;
            copyButton.disabled = false;
        }

        function clearForm() {
            document.querySelectorAll('.var2.selected, .var3.selected, .var4.selected').forEach(button => {
                button.classList.remove('selected');
            });
            notesField.value = '';
            outputArea.textContent = '';
            copyButton.disabled = true;
            enableDateFieldCheckbox.checked = true;
            enableNotesFieldCheckbox.checked = true;
            setCurrentDate(); // Reset date field
            setDefaultSelections(); // Re-apply default button selections
        }
        
        // Custom message box functions (Improved)
        let messageBoxHideTimeout = null;
        let messageBoxDisplayTimeout = null;

        function showMessageBox(message) {
            let msgBox = document.getElementById('customMessageBox');
            if (!msgBox) {
                msgBox = document.createElement('div');
                msgBox.id = 'customMessageBox';
                document.body.appendChild(msgBox);
            }
            msgBox.textContent = message;

            // Clear any existing hide timeouts to handle rapid calls
            if (messageBoxHideTimeout) clearTimeout(messageBoxHideTimeout);
            if (messageBoxDisplayTimeout) clearTimeout(messageBoxDisplayTimeout);

            msgBox.style.display = 'block'; // Make it part of the layout

            // Use requestAnimationFrame to ensure display:block is rendered before adding .show for transition
            requestAnimationFrame(() => {
                // A second RAF can sometimes help ensure the transition starts smoothly after display change.
                requestAnimationFrame(() => { 
                    msgBox.classList.add('show');
                });
            });

            messageBoxHideTimeout = setTimeout(() => {
                msgBox.classList.remove('show'); // Start fade out animation

                messageBoxDisplayTimeout = setTimeout(() => {
                    // Only set display:none if it's still meant to be hidden (not re-shown by another call)
                    if (!msgBox.classList.contains('show')) {
                         msgBox.style.display = 'none';
                    }
                }, 300); // Match CSS transition duration (0.3s)
            }, 2000); // How long the message stays fully visible
        }


        function copyToClipboard() {
            const textToCopy = outputArea.textContent;
            if (!textToCopy) {
                showMessageBox('Please generate a message first!');
                return;
            }

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showMessageBox('Message copied to clipboard!');
                }).catch(err => {
                    console.warn('Async clipboard copy failed, falling back.', err);
                    fallbackCopyText(textToCopy);
                });
            } else {
                console.warn('Async clipboard API not available, falling back.');
                fallbackCopyText(textToCopy);
            }
        }

        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            // Styling to make it non-intrusive and off-screen
            textArea.style.position = 'fixed';
            textArea.style.top = '-9999px';
            textArea.style.left = '-9999px';
            textArea.style.width = '1px';
            textArea.style.height = '1px';
            textArea.style.opacity = '0';
            textArea.style.border = 'none';
            textArea.style.padding = '0';
            textArea.style.margin = '0';
            textArea.style.overflow = 'hidden';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessageBox('Message copied (fallback)!');
                } else {
                    showMessageBox('Fallback copy failed.');
                }
            } catch (err) {
                console.error('Error during fallback copy:', err);
                showMessageBox('Error copying (fallback).');
            }
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>
